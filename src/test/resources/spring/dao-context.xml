<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:jpa="http://www.springframework.org/schema/data/jpa" xmlns:p="http://www.springframework.org/schema/p"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="http://www.springframework.org/schema/data/repository http://www.springframework.org/schema/data/repository/spring-repository-1.7.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa-1.3.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.1.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.1.xsd">

    <bean id=  "transactionManager" 
        class="org.springframework.orm.jpa.JpaTransactionManager"
        p:entityManagerFactory-ref="jpaFactory"
        p:dataSource-ref="datasource"/>    
    <tx:annotation-driven transaction-manager="transactionManager"/>

    <bean id = "datasource" class="com.mchange.v2.c3p0.ComboPooledDataSource"
        p:driverClass="org.hsqldb.jdbcDriver"
        p:jdbcUrl="${db.url}"
        p:user="${db.user}"
        p:password="${db.password}"
        p:initialPoolSize="1"
        p:minPoolSize="1"
        p:maxPoolSize="2"
    />   
    <bean id = "jpaFactory" 
        class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"
        p:dataSource-ref="datasource">
        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"
                p:showSql="true" />
        </property>
    </bean>

    <jpa:repositories base-package="ru.anr.base.samples.dao" 
        repository-impl-postfix="Impl" consider-nested-repositories="false"         
        entity-manager-factory-ref="jpaFactory" transaction-manager-ref="transactionManager" />

    <bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager"  
        p:cacheManager-ref="ehcache" p:transactionAware="true"/>

    <bean id="ehcache" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" 
        p:configLocation="classpath:/ehcache.xml"  p:shared="false" p:acceptExisting="true"/> 

</beans>
